name: reduce_cnr_coarse
steps:
  - id: sim
    task: sim.run
    sim: ${sim}
  - id: graph
    task: graphs.temporal_flux
    inputs:
      run_id: "@sim"
    params:
      windowing:
        type: log_time
        count: 3
        base: 10.0
      aggregation:
        mix:
          mean: 0.5
          p95: 0.5
      sparsify:
        quantile: 0.9
  - id: mapping
    task: reduction.dispatch
    inputs:
      graph_id: "@graph"
    method: cnr_coarse
    params:
      constraints:
        fields: [phase, charge]
      community:
        method: louvain
        resolution: 1.0
        min_weight: 0.0
        symmetrize: true
  - id: superstate
    task: features.superstate_timeseries
    inputs:
      run_id: "@sim"
      mapping_id: "@mapping"
    params:
      x_var: X
      wdot_var: net_production_rates
      include_wdot: true
