# 05_VISUALIZATION_STANDARDS（可視化規約）

可視化は「考察を最短にする」ための標準機能です。
一方、可視化コードは複雑化しやすいので **契約** を固定します。

## 1. 不変ルール
- viz は **Artifactを読むだけ**。
  - データ生成・特徴量化・学習・同化・縮退は別カテゴリで実施し、その結果をArtifactとして渡す。
- すべての図は **再現可能** であること。
  - 入力Artifact ID
  - 可視化設定
  - 生成日時
  をレポートに埋め込む。
- “同じArtifactなら同じ集計・同じ図” が原則（乱数・順序依存を避ける）。
- 図生成で「閾値」など判断が入る場合、その閾値は必ず config に置き、manifestに残す。

## 2. ダッシュボード体系（標準）

### 2.1 DS dashboard（データサイエンティスト向け）
**目的**：
- 多条件実行の健康状態（失敗・外れ値・計算時間）
- 観測 vs 予測（同化/学習の妥当性）
- 最適化の進捗（収束・パレート）

**P0 必須グラフ**
1) 実行サマリ
- 条件分布（主要パラメータのヒスト/散布）
- 計算時間分布、失敗率、エラー種別

2) 目的変数の可視化
- `objective`（膜厚/組成/占有率） vs 条件 の散布図
- 目的変数の分布、外れ値候補

3) 同化/最適化の進捗
- best-so-far（単目的）
- パレートフロント（多目的）
- 観測 vs 予測、残差（条件別）

4) 重要度/感度
- 反応×観測の感度ヒートマップ（Top-Nに絞る）
- 条件間の重要度の一貫性（rank correlation）

**P1 推奨**
- 特徴量の分布ドリフト（条件スプリットの妥当性）
- 代理モデル（サロゲート）診断（予測誤差、信頼区間、キャリブレーション）

### 2.2 Chem dashboard（化学/反応速度論向け）
**目的**：
- 主要種・主要反応の支配構造を短時間で把握
- 縮退前後で「何が変わったか」を定量確認

**P0 必須グラフ**
1) 種の時間変化
- 主要種（Top-N）の濃度/モル分率時系列
- 生成/消滅（net production rate）時系列

2) 反応寄与（ROP）
- reaction ROP Top-N（時間窓ごと or 全期間集約）
- 目的変数（膜厚など）への寄与が大きい反応 Top-N

3) 表面（CVD/ALD前提）
- 表面被覆率（coverage）時系列（主要被覆種）
- 反応タイプ別寄与（吸着/脱離/表面反応など）

4) 経路の概観
- 対象種（ターゲット）へのフラックス寄与（簡易サンキー/ネットワーク）
- 循環候補（SCC）の列挙（Top-K）

**P1 推奨**
- 縮退前後での ROP/パス寄与の差分（rank差分）
- 反応タイプ別にまとめた寄与（集約の妥当性評価に直結）

## 3. 出力形式
- `reports/<rep_id>/index.html` を標準とする
- 必要なら静的画像（png/svg）も同梱する
- report の manifest に以下を含める
  - 入力Artifact ID一覧
  - ダッシュボード種別（ds/chem）
  - 図の生成設定（Top-N, 閾値, 時間窓など）

### 3.1 静的画像の命名規約
- `viz/` 配下に用途別ディレクトリのみ作成する（network / timeseries / reduction）
- ファイル名は `"<plot>__<run_id>__<tag>.<ext>"` を標準とする
  - 例: `species__demo01__X.svg`, `rates__demo01__net_production_rates.svg`

## 4. 実装ガイド（最小依存）
- P0は `plotly` を基本（HTMLに埋め込みやすい）
- 高負荷を避けるため、データは事前に features/sensitivity で集約しておく
- “巨大な時系列をそのまま描く” を避け、Top-N + downsample を基本とする
